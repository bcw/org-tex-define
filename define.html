<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Org mode LaTeX macros (for both HTML and LaTeX export)</title>
<!-- 2016-08-21 Sun 20:36 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Brian C. Wells" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js"></script>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Org mode LaTeX macros (for both HTML and LaTeX export)</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">Define the Org mode macros</a>
<ul>
<li><a href="#sec-1-1">when-fmt macro</a></li>
<li><a href="#sec-1-2">preamble macro</a></li>
<li><a href="#sec-1-3">define macro</a></li>
</ul>
</li>
<li><a href="#sec-2">Usage Example</a></li>
</ul>
</div>
</div>
<p>
\(\newcommand{\mat}[1]{\mathbf{#1}}\)
</p>

<p>
This document should be exported to <a href="define.html">HTML</a> and <a href="define.tex">LaTeX</a> to check that the
proper code is generated.  <a href="define.pdf">A PDF file</a> should also be available, but
looks a bit bad because Org mode macros <i>must</i> be written on a single
line, and some of these macros overfill the line (even in a fairly
small font).
</p>

<p>
This Literate Program is an Org mode setup file that makes it easy to
define LaTeX macros that work in <i>both</i> LaTeX and HTML export.  To
"tangle" the source code (<code>define.org</code>) for this document to generate
the <code>define.setup</code> file, type the key sequence <code>C-c C-v t</code> in Emacs
(with the default keymap).  The first line makes sure that the file
can be edited in org-mode despite the file being named with an
extension of <code>.setup</code>.
</p>

<div class="org-src-container">

<pre class="src src-org"># -*- mode: org -*-
#+MACRO: when-fmt (eval (when (org-export-derived-backend-p org-export-current-backend '$1) "$2"))
#+MACRO: preamble {{{when-fmt(html,\\($1\\))}}}{{{when-fmt(latex,#+LATEX_HEADER: $1)}}}
#+MACRO: define   {{{preamble(\\newcommand{$1}$2)}}}
</pre>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Define the Org mode macros</h2>
<div class="outline-text-2" id="text-1">
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">when-fmt macro</h3>
<div class="outline-text-3" id="text-1-1">
<p>
This is inspired by the <code>if-latex-else</code> macro under the `Advanced'
heading here: <a href="https://github.com/fniessen/org-macros">https://github.com/fniessen/org-macros</a>. Apparently,
Org mode will evalute Emacs Lisp code in macros, although I have not
yet found any documentation that explains <i>why</i> this works.
</p>

<p>
The <code>when</code> form is like <code>if</code>, except it only returns a string when the
condition is true, returning <code>nil</code> instead when it is false.  We use
<code>when</code> because we want to perform an action for LaTeX and HTML
formats, and we do not want to assume that the user wants the same
behavior for all non-LaTeX or non-HTML formats.
</p>

<div class="org-src-container">

<pre class="src src-org">#+MACRO: when-fmt (eval (when (org-export-derived-backend-p org-export-current-backend '$1) "$2"))
</pre>
</div>

<p>
Since the second parameter <code>$2</code> is used inside quotes, it will be
necessary to double any backslashes, despite the fact that Org mode
macros do not normally require this (except between parameters).
</p>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">preamble macro</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Using the <a href="#sec-1-1">when-fmt macro</a>, we wrap HTML output in <code>\(...\)</code> so that <a href="http://docs.mathjax.org/en/latest/tex.html#defining-tex-macros">the
MathJax library will recognize that it should process them</a>.  So long
as we only use this to define LaTeX macros, MathJax will not generate
any spurious output.  In LaTeX output, we use the <code>#+LATEX_HEADER:</code>
Org mode syntax to ensure that it is put in the proper LaTeX preamble.
</p>

<div class="org-src-container">

<pre class="src src-org">#+MACRO: preamble {{{when-fmt(html,\\($1\\))}}}{{{when-fmt(latex,#+LATEX_HEADER: $1)}}}
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3">define macro</h3>
<div class="outline-text-3" id="text-1-3">
<p>
Using the <a href="#sec-1-2">preamble macro</a>, we specify a macro that uses the LaTeX
<code>\newcommand</code> macro to define macros.  The first argument is the macro
command sequence, and the second argument is whatever LaTeX code is
needed for the definition.  Note that we wrap the command sequence in
<code>{...}</code> automatically, since this is always done.  The second
parameter is not, however, because it is sometimes necessary to write
a number in square brackets <code>[...]</code> when the macro takes parameters.
</p>

<div class="org-src-container">

<pre class="src src-org">#+MACRO: define   {{{preamble(\\newcommand{$1}$2)}}}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Usage Example</h2>
<div class="outline-text-2" id="text-2">
<p>
Say you want to define a <code>\mat</code> command to write the names of
matrices, as in <code>\mat{A}</code> for \(\mat{A}\).
</p>

<p>
At the beginning of the file, you should add
</p>
<pre class="example">
#+SETUPFILE: define.setup
</pre>
<p>
and then you can write
</p>
<pre class="example">
{{{define(\\mat,[1]{\\mathbf{#1}})}}}
</pre>
<p>
and use it as follows:
</p>
<pre class="example">
$\mat{A}$
</pre>

<p>
Again, remember: it is necessary to double the backslashes.  And the
result looks like this: \(\mat{A}\).
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Brian C. Wells</p>
<p class="date">Created: 2016-08-21 Sun 20:36</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.5.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
